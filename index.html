<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KounoTrip - めぐる、あつめる、豊岡の旅</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#D64545">

    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="KounoTrip">
    <link rel="apple-touch-icon" href="/placeholder.svg?height=180&width=180">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>
<body class="brush-bg">
    <div class="container">
        <!-- Location Permission Screen (Fullscreen) -->
        <div id="location-permission" class="permission-screen hidden">
            <div class="setup-card">
                <div class="setup-header">
                    <div class="setup-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                        </svg>
                    </div>
                    <h1 class="setup-title">位置情報の使用許可</h1>
                    <p class="setup-description">スタンプの取得のために位置情報が必要です</p>
                </div>
                <div class="setup-body">
                    <div class="feature-list">
                        <div class="feature-item blue">
                            <div class="feature-icon blue">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                </svg>
                            </div>
                            <div class="feature-content">
                                <h4 class="blue">プライバシー保護</h4>
                                <p class="blue">位置情報はスタンプ取得の確認にのみ使用され、外部に送信されることはありません。</p>
                            </div>
                        </div>
                        <div class="feature-item green">
                            <div class="feature-icon green">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </div>
                            <div class="feature-content">
                                <h4 class="green">スタンプ取得</h4>
                                <p class="green">観光地の近くにいる時のみスタンプを取得できます。</p>
                            </div>
                        </div>
                        <div class="feature-item purple">
                            <div class="feature-icon purple">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                                </svg>
                            </div>
                            <div class="feature-content">
                                <h4 class="purple">距離表示</h4>
                                <p class="purple">現在地から各観光地までの距離を表示します。</p>
                            </div>
                        </div>
                    </div>
                    <div class="button-section">
                        <button class="primary-button" onclick="app.handleLocationPermission()">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            位置情報の使用を許可
                        </button>
                        <button class="secondary-button" onclick="app.handleLocationDenied()">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            許可しない（一部機能が制限されます）
                        </button>
                    </div>
                    <div class="notice">
                        位置情報を許可しない場合、スタンプの取得や距離表示機能が利用できません。<br>
                        設定はブラウザの設定からいつでも変更できます。
                    </div>
                </div>
            </div>
        </div>

        <!-- Mode Select Screen (Fullscreen) -->
        <div id="mode-select" class="fullscreen hidden">
            <div class="mode-cards">
                <div class="mode-card" onclick="selectMode('course')">
                    <div class="mode-card-icon">🗺️</div>
                    <h2 class="mode-card-title">コースで巡る</h2>
                    <p class="mode-card-description">
                        事前に用意されたモデルコースに沿って効率よく観光地を巡ります。
                        初めての方におすすめです。
                    </p>
                </div>
                <div class="mode-card" onclick="selectMode('free')">
                    <div class="mode-card-icon">🎯</div>
                    <h2 class="mode-card-title">自由に巡る</h2>
                    <p class="mode-card-description">
                        お好きな順番で観光地を巡ることができます。
                        自分だけのルートを作りたい方におすすめです。
                    </p>
                </div>
            </div>
        </div>

        <!-- Start Gate Screen (Fullscreen) -->
        <div id="start-gate" class="fullscreen hidden">
            <div class="start-gate-card">
                <h2 style="text-align: center; margin-bottom: 1.5rem; color: var(--brand-primary);">
                    ニックネームを入力
                </h2>
                <input
                    type="text"
                    id="nickname-input"
                    class="nickname-input"
                    placeholder="例: 豊岡太郎"
                    maxlength="20"
                >
                <div id="input-validation" class="input-validation">
                    1〜20文字で入力してください（絵文字も使用可能）
                </div>
                <button id="start-btn" class="start-btn" disabled>
                    スタンプラリーを開始
                </button>
            </div>
        </div>

        <!-- Main App -->
        <div id="main-app" class="hidden">
            <!-- Header -->
            <div class="header">
                <button class="mode-change-btn" onclick="showModeSelect()">
                    モード変更
                </button>
                <div class="app-icon">🏯</div>
                <h1 class="app-title">KounoTrip</h1>
                <p class="app-subtitle">めぐる、あつめる、豊岡の旅</p>
                <div class="location-status loading" id="location-status">
                    <div class="spinner"></div>
                    位置情報を取得中...
                    <button class="location-update-btn" onclick="app.updateLocation()" id="location-update-btn">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        更新
                    </button>
                </div>
            </div>

            <!-- Landing Screen -->
            <div id="landing" class="screen active">

                <!-- Continue Section (if in progress) -->
                <div id="continue-section" class="continue-section hidden">
                    <h3 class="continue-title">進行中のコース</h3>
                    <p id="continue-course-name">出石 城下町散策コース</p>
                    <button class="continue-btn" onclick="continueCourse()">
                        つづきを再開
                    </button>
                </div>

                <!-- Course Grid -->
                <div id="course-grid" class="course-grid">
                    <!-- Courses will be populated by JavaScript -->
                </div>
            </div>

            <!-- Map View Screen -->
            <div id="map-view" class="screen">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                            </svg>
                            観光地マップ
                        </div>
                        <div class="card-description" id="map-description">地域別に観光地を確認できます</div>
                    </div>
                    <!-- Map Container -->
                    <div id="map-container" class="map-container">
                        <!-- Leaflet map will be initialized here -->
                    </div>
                </div>

                <!-- Map content will be populated by JavaScript -->
                <div id="map-content"></div>
            </div>

            <!-- Nearby View Screen -->
            <div id="nearby-view" class="screen">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            スタンプ獲得
                        </div>
                        <div class="card-description">観光地から150m以内でスタンプを押せます</div>
                    </div>

                    <!-- Stats Section -->
                    <div id="stamp-stats" class="stamp-stats">
                        <div class="stamp-stat">
                            <div class="stamp-stat-number accent" id="collected-count">0</div>
                            <div class="stamp-stat-label">取得済み</div>
                        </div>
                        <div class="stamp-stat">
                            <div class="stamp-stat-number success" id="total-points">0</div>
                            <div class="stamp-stat-label">ポイント</div>
                        </div>
                        <div class="stamp-stat">
                            <div class="stamp-stat-number plum" id="achievement-rate">0%</div>
                            <div class="stamp-stat-label">達成率</div>
                        </div>
                    </div>
                </div>

                <!-- Stamp content will be populated by JavaScript -->
                <div id="stamp-content"></div>
                <!-- スタンプ取得時のアニメーション + ガイド音声モーダル -->
                <div id="stamp-guide-modal" class="hidden" aria-hidden="true">
                    <div class="modal-overlay" id="stamp-modal-overlay"></div>
                    <div class="modal-card" id="stamp-modal-card" role="dialog" aria-modal="true" aria-labelledby="stamp-modal-title">
                        <div class="modal-body">
                            <div class="stamp-animation" id="stamp-animation">
                                <div class="stamp-circle"></div>
                                <div class="stamp-icon" id="stamp-modal-icon">📍</div>
                            </div>
                            <h3 id="stamp-modal-title" class="stamp-modal-title">スポット名</h3>
                            <p id="stamp-modal-desc" class="stamp-modal-desc">スポットの説明がここに表示されます。</p>
                        </div>
                        <div class="modal-controls">
                            <button id="stamp-modal-close" class="btn">閉じる</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Courses View Screen -->
            <div id="courses-view" class="screen">


                <!-- Continue Section -->
                <div id="courses-continue-section" class="continue-section hidden">
                    <h3 class="continue-title">進行中のコース</h3>
                    <p id="courses-continue-name">出石 城下町散策コース</p>
                    <button class="continue-btn" onclick="continueCourse()">
                        つづきを再開
                    </button>
                </div>

                <div id="courses-grid" class="course-grid">
                    <!-- Courses will be populated by JavaScript -->
                </div>
            </div>

            <!-- Profile View Screen -->
            <div id="profile-view" class="screen">
                <div class="card profile-card">
                    <div class="profile-header">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                        </svg>
                        <div>
                            <div class="profile-title">達成度 <span id="profile-achievement">0</span>%</div>
                            <div class="profile-description">
                                <span id="profile-points">0</span> ポイント • <span id="profile-rank">Beginner</span> 🔰
                            </div>
                        </div>
                    </div>
                    <div class="progress-bar-profile">
                        <div class="progress-fill-profile" id="profile-progress-fill" style="width: 0%"></div>
                    </div>
                    <p style="font-size: 0.875rem;">
                        <span id="profile-spots">0</span> / <span id="profile-total-spots">0</span> スポット訪問済み
                    </p>
                </div>

                <div class="card">
                    <div class="card-header" style="background: linear-gradient(135deg, #6366f1, #8b5cf6);">
                        <div class="card-title">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                            #要修正　統計
                        </div>
                    </div>
                    <div class="settings-content">
                        <div class="setting-item">
                            <span class="setting-label">訪問スポット数</span>
                            <span style="font-weight: 700;"><span id="profile-visited">0</span> / <span id="profile-total">0</span></span>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">総訪問回数</span>
                            <span style="font-weight: 700;" id="profile-visit-count">0回</span>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">達成率</span>
                            <span style="font-weight: 700; color: #059669;" id="profile-achievement-rate">0%</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" style="background: linear-gradient(135deg, #f59e0b, #f97316);">
                        <div class="card-title">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                            </svg>
                            獲得バッジ
                        </div>
                    </div>
                    <div class="badges-grid" id="badges-grid">
                        <!-- Badges will be populated by JavaScript -->
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" style="background: linear-gradient(135deg, #14b8a6, #10b981);">
                        <div class="card-title">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            最近の訪問履歴
                        </div>
                    </div>
                    <div id="visit-history">
                        <!-- Visit history will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Settings View Screen -->
            <div id="settings-view" class="screen">
                <h2 style="margin-bottom: 1.5rem; color: var(--brand-primary);">
                    設定
                </h2>

                <div class="card settings-section">
                    <div class="settings-header">
                        <div class="card-title">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                            ユーザー設定
                        </div>
                        <div class="card-description">プロフィール情報の管理</div>
                    </div>
                    <div class="settings-content">
                        <div class="setting-item">
                            <span class="setting-label">現在の達成度</span>
                            <span class="setting-value" id="settings-achievement">0%</span>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">訪問スポット数</span>
                            <span class="setting-value outline" id="settings-spots">0スポット</span>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">総訪問回数</span>
                            <span class="setting-value blue" id="settings-visits">0回</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" style="background: linear-gradient(135deg, #6b7280, #4b5563);">
                        <div class="card-title">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                            </svg>
                            データ管理
                        </div>
                        <div class="card-description">データのバックアップと復元</div>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-outline" onclick="app.exportData()" style="flex: 1; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1rem; height: 1rem;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                            </svg>
                            エクスポート
                        </button>
                        <button class="btn btn-primary" onclick="app.resetData()" style="flex: 1; display: flex; align-items: center; justify-content: center; gap: 0.5rem; background: #ef4444;">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1rem; height: 1rem;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                            リセット
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div style="text-align: center; padding: 1rem;">
                        <p style="font-size: 0.875rem; color: #64748b; margin-bottom: 0.25rem;">KounoTrip</p>
                        <p style="font-size: 0.875rem; color: #64748b; margin-bottom: 0.25rem;">バージョン 1.0.0</p>
                        <p style="font-size: 0.75rem; color: #9ca3af;">© 2025 KounoTrip</p>
                    </div>
                </div>
            </div>

            <!-- Bottom Tab Bar -->
            <div class="tabbar" id="tabbar">
                <button class="tab" data-tab="map" data-active="false" onclick="switchTab('map')">
                    <div class="tab-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                        </svg>
                    </div>
                    <span>マップ</span>
                </button>
                <button class="tab" data-tab="nearby" data-active="false" onclick="switchTab('nearby')">
                    <div class="tab-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </div>
                    <span>近く</span>
                </button>
                <button class="tab" data-tab="courses" data-active="false" onclick="switchTab('courses')">
                    <div class="tab-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                        </svg>
                    </div>
                    <span>コース</span>
                </button>
                <button class="tab" data-tab="profile" data-active="false" onclick="switchTab('profile')">
                    <div class="tab-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                    </div>
                    <span>プロフィール</span>
                </button>
                <button class="tab" data-tab="settings" data-active="false" onclick="switchTab('settings')">
                    <div class="tab-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </div>
                    <span>設定</span>
                </button>
            </div>
        </div>

        <!-- Course Detail Modal -->
        <div id="course-detail-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modal-course-title" class="modal-title">出石 城下町散策コース</h2>
                    <button class="close-btn" onclick="closeCourseDetail()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="course-detail-grid">
                        <div class="course-info">
                            <h3>コース詳細</h3>
                            <p id="modal-course-description" class="course-description">
                                但馬の小京都・出石をめぐる定番コース。歴史ある建物と美しい街並みを楽しめます。
                            </p>
                            <div id="modal-course-badges" class="course-badges">
                                <!-- Badges will be populated by JavaScript -->
                            </div>
                        </div>
                        <div class="static-map">
                            📍 コースマップ
                        </div>
                    </div>

                    <button id="modal-start-btn" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;" onclick="startCourse()">
                        このコースでスタート
                    </button>

                    <div class="poi-timeline">
                        <h4 style="margin-bottom: 1rem;">立ち寄り地点</h4>
                        <div id="modal-poi-timeline">
                            <!-- Timeline will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Spot Detail Modal -->
        <div id="spot-detail-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="spot-modal-title" class="modal-title">辰鼓楼</h2>
                    <button class="close-btn" onclick="closeSpotDetail()">&times;</button>
                </div>
                <div class="modal-body">
                    <p id="spot-modal-description" style="color: #64748b; margin-bottom: 1.5rem;">出石の代名詞と呼べる建築物</p>

                    <img src="/placeholder.svg?height=128&width=384" alt="" class="modal-image" id="spot-modal-image">

                    <div class="modal-section">
                        <h4 class="section-title">
                          <svg fill="none" stroke="#1F2937" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" style="width: 1.25rem; height: 1.25rem; flex-shrink: 0;">
                            <circle cx="12" cy="7" r="1"/>
                            <line x1="12" y1="11" x2="12" y2="17"/>
                          </svg>
                            詳細情報
                        </h4>
                        <p class="section-content" id="spot-modal-detailed">明治4年に建てられた時計台。出石のシンボルとして親しまれており、現在も正確な時を刻み続けています。</p>
                    </div>

                    <div class="modal-section">
                        <h4 class="section-title">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            住所
                        </h4>
                        <a href="#" target="_blank" class="section-content" id="spot-modal-address">〒668-0214 兵庫県豊岡市出石町内町</a>
                        <p class="section-content-notice">住所をクリックするとgoogleマップが起動します</p>
                    </div>

                    <div class="modal-section">
                        <h4 class="section-title">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                            </svg>
                            アクセス
                        </h4>
                        <p class="section-content" id="spot-modal-access">JR豊岡駅からバスで30分、出石営業所下車徒歩5分</p>
                    </div>

                    <div class="modal-section">
                        <h4 class="section-title">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            営業時間
                        </h4>
                        <p class="section-content" id="spot-modal-hours">24時間見学可能</p>
                    </div>

                    <div class="modal-section">
                        <h4 class="section-title">
                            <svg fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                            </svg>
                            おすすめポイント
                        </h4>
                        <div class="highlights" id="spot-modal-highlights">
                            <!-- Highlights will be populated by JavaScript -->
                        </div>
                    </div>

                    <div class="modal-footer">
                        <div class="points-display">
                            <svg fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            <span class="points-text" id="spot-modal-points">1ポイント</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script src="script.js"></script>

</body>
</html>